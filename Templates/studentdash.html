
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sidebar with Icons & Topbar</title>
    <link rel="stylesheet" href="/static/stud.css">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Add this CSS for modal transitions */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            transition: opacity 0.3s ease;
        }

        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 400px;
            max-width: 90%;
            border-radius: 8px;
            position: relative;
            transition: transform 0.3s ease, opacity 0.3s ease;
            transform: translateY(-20px);
            opacity: 0;
        }

        .modal.active .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }
    </style>
</head>
<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <h2>KTU Activity Point Management System</h2>
        <nav>
            <a href="{{ url_for('student_dashboard') }}" class="menu-item active"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a href="{{ url_for('activity_submission') }}" class="menu-item"><i class="fas fa-baa-aa"></i> Activity submission</a>
            <a href="{{ url_for('reports') }}" class="menu-item"><i class="fas fa-chart-bar"></i> Reports</a>
        </nav>
    </div>

    <!-- Topbar -->
    <header class="topbar">
        <div class="user-info">
            <i class="fas fa-user-circle"></i>
            <span id="student-name">{{ session['user_name'] }}</span>
            <a href="{{url_for('home')}}" class="home-link"><i class="fas fa-home"></i> Home</a>
            <a href="{{url_for('login')}}" class="home-link"><i class="fas fa-home"></i> Logout</a>
        </div>
    </header>

    <div class="main-area">
        <!-- Dashboard Page -->
        <div id="dashboard-page" class="content-page active-page">
            <div class="welcome-banner">
                <h3>Welcome, {{current_user.name}}</h3>
                <p class="mb-0">Track your activity points progress and stay updated with your submissions</p>
            </div>

            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="info-card h-100">
                        <h5>Student Information</h5>
                        <hr>
                        <div class="row mb-2">
                            <div class="col-5 fw-bold">Registration No:</div>
                            <div class="col-7">{{current_user.student_id}}</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-5 fw-bold">Department:</div>
                            <div class="col-7">{{current_user.department}}</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-5 fw-bold">Batch:</div>
                            <div class="col-7">{{current_user.batch}}</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-5 fw-bold">Current Semester:</div>
                            <div class="col-7">{{ current_semester }}</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-5 fw-bold">Email:</div>
                            <div class="col-7">{{current_user.email}}</div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 mb-4">
                    <div class="info-card h-100">
                        <h5>Activity Points Progress</h5>
                        <hr>
                        <div class="mb-4">
    <div class="d-flex justify-content-between mb-1">
        <span>Current Points:</span>
        <span class="fw-bold">{{ approved_points }}/100</span>
    </div>
    <div class="progress">
        <div class="progress-bar bg-success" role="progressbar"
             style="width: {{ progress_percentage }}%;"
             aria-valuenow="{{ approved_points }}" aria-valuemin="0" aria-valuemax="100">
        </div>
    </div>
    <small class="text-muted">{{ remaining_points }} more points needed to reach requirement</small>
</div>


                        <div class="row">
    <div class="col-6">
        <div class="border rounded p-3 text-center">
            <h3 class="text-primary">{{ total_submitted }}</h3>
            <small>Activities Submitted</small>
        </div>
    </div>
    <div class="col-6">
        <div class="border rounded p-3 text-center">
            <h3 class="text-success">{{ total_approved }}</h3>
            <small>Activities Approved</small>
        </div>
    </div>
</div>

                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12 mb-4">
                    <div class="info-card">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0">Recent Activities</h5>
                            <div>
                                <button id="filter-btn" class="btn btn-primary me-2"><i class="fas fa-filter"></i> Filter</button>
                                <a href="#activities" class="view-all-link" data-navigate="activities">View All</a>
                            </div>
                        </div>

                        <!-- Filter Popup -->
                        <div id="filter-popup" class="modal">
                            <div class="modal-content">
                                <span class="close">&times;</span>
                                <h5>Filter Activities</h5>
                                <form id="filter-form">
                                    <div class="mb-3">
                                        <label for="semester" class="form-label">Semester</label>
                                        <select class="form-select" id="semester">
                                            <option value="all">All</option>
                                            <option value="S1">S1</option>
                                            <option value="S2">S2</option>
                                            <option value="S3">S3</option>
                                            <option value="S4">S4</option>
                                            <option value="S5">S5</option>
                                            <option value="S6">S6</option>
                                            <option value="S7">S7</option>
                                            <option value="S8">S8</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="activity-type" class="form-label">Activity Type</label>
                                        <select class="form-select" id="activity-type">
                                            <option value="all">All</option>
                                            <option value="Technical">Technical</option>
                                            <option value="Workshop">Workshop</option>
                                            <option value="NSS">NSS</option>
                                            <option value="Coding">Coding</option>
                                            <option value="Seminar">Seminar</option>
                                            <option value="Internship">Internship</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="status" class="form-label">Status</label>
                                        <select class="form-select" id="status">
                                            <option value="all">All</option>
                                            <option value="Approved">Approved</option>
                                            <option value="Pending">Pending</option>
                                            <option value="Rejected">Rejected</option>
                                        </select>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Apply Filter</button>
                                </form>
                            </div>
                        </div>

                       <div class="table-responsive">
    <table id="activities-table" class="table table-hover">
        <thead>
            <tr>
                <th>Activity Type</th>
                <th>Submission Date</th>
                <th>Status</th>
                <th>Points</th>
            </tr>
        </thead>
        <tbody>
            {% for submission in submissions %}
            <tr>
                <td>{{ submission.activity.name }}</td>
                <td>{{ submission.date_submitted.strftime('%d %b %Y') }}</td>
                <td>
                    {% if submission.status == 'approved' %}
                        <span class="badge bg-success">Approved</span>
                    {% elif submission.status == 'pending' %}
                        <span class="badge bg-warning text-dark">Pending</span>
                    {% else %}
                        <span class="badge bg-danger">Rejected</span>
                    {% endif %}
                </td>
                <td>
                    {% if submission.status == 'approved' %}
                        {{ submission.points_requested }}
                    {% else %}
                        --
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4" class="text-center">No recent activities found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // JavaScript for Filter Popup and Table Filtering
        document.getElementById('filter-btn').addEventListener('click', function() {
            document.getElementById('filter-popup').classList.add('active');
            document.getElementById('filter-popup').style.display = 'block';
        });

        document.querySelector('.close').addEventListener('click', function() {
            document.getElementById('filter-popup').classList.remove('active');
            setTimeout(() => {
                document.getElementById('filter-popup').style.display = 'none';
            }, 300);
        });

        document.getElementById('filter-popup').addEventListener('click', function(event) {
            if (event.target === this) {
                this.classList.remove('active');
                setTimeout(() => {
                    this.style.display = 'none';
                }, 300);
            }
        });

        document.getElementById('filter-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const semester = document.getElementById('semester').value;
            const activityType = document.getElementById('activity-type').value;
            const status = document.getElementById('status').value;

            filterTable(semester, activityType, status);
            document.getElementById('filter-popup').classList.remove('active');
            setTimeout(() => {
                document.getElementById('filter-popup').style.display = 'none';
            }, 300);
        });

        document.querySelector('.view-all-link').addEventListener('click', function(event) {
            event.preventDefault(); // Prevent the default link behavior
            filterTable('all', 'all', 'all'); // Reset filters to show all rows
        });

        function filterTable(semester, activityType, status) {
            const rows = document.querySelectorAll('#activities-table tbody tr');
            rows.forEach(row => {
                const rowSemester = row.cells[1].textContent.trim(); // Semester column
                const rowActivityType = row.cells[0].textContent.trim(); // Activity Type column
                const rowStatus = row.cells[3].textContent.trim(); // Status column

                const semesterMatch = semester === 'all' || rowSemester === semester;
                const activityTypeMatch = activityType === 'all' || rowActivityType === activityType;
                const statusMatch = status === 'all' || rowStatus === status;

                if (semesterMatch && activityTypeMatch && statusMatch) {
                    row.style.display = ''; // Show the row
                } else {
                    row.style.display = 'none'; // Hide the row
                }
            });
        }
    </script>
</body>
</html>